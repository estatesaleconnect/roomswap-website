<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gallery | Room Swap Consignments</title>
    <meta name="description" content="Browse our current inventory of quality furniture and home decor at Room Swap Consignments in Holly Hill, SC.">
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Crimson+Text:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <div class="header-container">
            <a href="index.html" class="logo-container" aria-label="Room Swap - Furniture & Treasures - Home">
                <span class="logo-main">ROOM SWAP</span>
                <span class="logo-divider"></span>
                <span class="logo-sub">Furniture &amp; Treasures</span>
            </a>
            <button class="menu-toggle" aria-label="Toggle menu">â˜°</button>
            <nav>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="about.html">How It Works</a></li>
                    <li><a href="gallery.html" class="active">Gallery</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <section>
            <h1 class="section-title">Current Inventory</h1>
            <p>Our showroom inventory changes weekly as pieces sell and new items arrive. Stop by to see everything in person, or check back here regularly for updates on what's currently available.</p>
            <p style="margin-top: 1rem; color: var(--warm-gray); font-style: italic;">Photos updated weekly. Not all inventory may be shown online.</p>
        </section>

        <section>
            <div id="gallery-container" class="gallery-grid">
                <div class="loading">Loading gallery...</div>
            </div>
            <div id="no-results" class="no-results" style="display: none;">
                <p>No photos have been added yet. Check back soon, or visit us in person to see our full inventory.</p>
            </div>
        </section>
    </main>

    <footer>
        <div class="footer-content">
            <p><strong>Room Swap Consignments</strong></p>
            <p>8531 Old State Road, Holly Hill, South Carolina 29059</p>
            <p>Phone: <a href="tel:8439001420">843-900-142</a> | Email: <a href="mailto:roomswapsc@gmail.com">roomswapsc@gmail.com</a></p>
            <p style="margin-top: 1rem; opacity: 0.7;">Open Tuesday-Saturday, 12-5pm</p>
        </div>
    </footer>

    <script>
        // Mobile menu toggle
        document.querySelector('.menu-toggle').addEventListener('click', function() {
            document.querySelector('nav').classList.toggle('active');
        });

        // Close menu when clicking outside
        document.addEventListener('click', function(event) {
            const nav = document.querySelector('nav');
            const toggle = document.querySelector('.menu-toggle');
            if (!nav.contains(event.target) && !toggle.contains(event.target)) {
                nav.classList.remove('active');
            }
        });

        // Load gallery from CMS via GitHub API
        async function loadGallery() {
            const container = document.getElementById('gallery-container');
            const noResults = document.getElementById('no-results');
            
            try {
                // Fetch gallery items from GitHub API
                const response = await fetch('https://api.github.com/repos/estatesaleconnect/roomswap-website/contents/_gallery');
                
                if (!response.ok) {
                    throw new Error('Gallery not found');
                }
                
                const files = await response.json();
                const jsonFiles = files.filter(file => file.name.endsWith('.json') && file.name !== 'gallery.json');
                
                if (jsonFiles.length === 0) {
                    container.style.display = 'none';
                    noResults.style.display = 'block';
                    return;
                }
                
                // Fetch each JSON file
                const items = await Promise.all(
                    jsonFiles.map(async (file) => {
                        const fileResponse = await fetch(file.download_url);
                        return await fileResponse.json();
                    })
                );
                
                // Clear loading message
                container.innerHTML = '';
                
                // Sort items by date (newest first)
                items.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                // Create gallery items
                items.forEach(item => {
                    const galleryItem = document.createElement('div');
                    galleryItem.className = 'gallery-item';
                    
                    const img = document.createElement('img');
                    // Fix the image path - it's stored relative to root
                    img.src = item.image.startsWith('/') ? item.image : '/' + item.image;
                    img.alt = item.title || 'Room Swap inventory item';
                    img.loading = 'lazy';
                    
                    // Error handling for broken images
                    img.onerror = function() {
                        this.parentElement.style.display = 'none';
                    };
                    
                    galleryItem.appendChild(img);
                    
                    // Add caption if there's a title or description
                    if (item.title || item.description) {
                        const caption = document.createElement('div');
                        caption.className = 'gallery-caption';
                        
                        let captionText = '';
                        if (item.title) captionText += `<strong>${item.title}</strong>`;
                        if (item.description) captionText += (item.title ? '<br>' : '') + item.description;
                        
                        caption.innerHTML = captionText;
                        galleryItem.appendChild(caption);
                    }
                    
                    container.appendChild(galleryItem);
                });
                
            } catch (error) {
                console.log('Gallery error:', error);
                container.style.display = 'none';
                noResults.style.display = 'block';
            }
        }
        
        // Load gallery on page load
        loadGallery();
    </script>
</body>
</html>
